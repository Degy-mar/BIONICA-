<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Malla Curricular Biónica</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');

    body {
      font-family: 'Inter', sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 10px;
    }

    .header {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
      margin-bottom: 10px;
    }

    h1 {
      text-align: center;
      grid-column: 2;
      font-size: 22px;
      margin: 0;
    }

    #promedio {
      text-align: right;
      font-weight: bold;
      font-size: 16px;
      color: #444;
      grid-column: 3;
    }

    #contador {
      text-align: left;
      font-weight: bold;
      font-size: 16px;
      color: #444;
      grid-column: 1;
    }

    .años-container {
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-items: center;
    }

    .fila {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .semestre-card {
      background: #e0e0e0;
      border-radius: 8px;
      padding: 6px;
      width: 240px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
    }

    .semestre-title {
      font-weight: bold;
      font-size: 14px;
      text-align: center;
      background-color: #bdbdbd;
      padding: 5px;
      border-radius: 8px 8px 0 0;
      color: #222;
    }

    .subject {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 4px 2px;
      padding: 4px 6px;
      border-radius: 6px;
      font-size: 11px;
      background-color: white;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
      cursor: pointer;
      transition: background 0.3s;
    }

    .subject.locked {
      opacity: 0.4;
      pointer-events: none;
    }

    .subject .info.aprobada {
      text-decoration: line-through;
    }

    .credits {
      width: 22px;
      height: 22px;
      font-size: 10px;
      border-radius: 50%;
      background: currentColor;
      color: white;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      flex-shrink: 0;
      margin-right: 4px;
    }

    .temario, .calificacion-icon {
      margin-left: 4px;
      cursor: pointer;
      font-size: 13px;
      flex-shrink: 0;
    }

    .matematicas    { color: #98A1BC; }
    .fisicas       { color: #9798AE; }
    .biologicas        { color: #AEB4AC; }
    .programacion    { color: #B56B6B; }
    .electronica        { color: #A14D4D; }
    .sociales       { color: #A3909F; }
    .idiomas        { color: #C7C2BB; }
    .otros          { color: #B7B2A9; }

    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      right: 0; bottom: 0;
      background: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
      z-index: 999;
    }

    .modal-content {
      background: #fff;
      padding: 16px;
      border-radius: 10px;
      max-width: 360px;
      text-align: center;
    }

    button {
      margin-top: 10px;
      padding: 6px 12px;
      border: none;
      background: #4b2e2e;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="header">
    <div id="contador"></div>
    <h1>Malla Curricular Biónica</h1>
    <div id="promedio">Promedio: -</div>
  </div>
  <div class="años-container" id="contenedor"></div>

  <div class="modal" id="modal">
    <div class="modal-content">
      <h2 id="modal-titulo"></h2>
      <div id="modal-cuerpo"></div>
      <input type="number" id="input-calificacion" placeholder="Calificación" min="0" max="100">
      <br>
      <button onclick="guardarCalificacion()">Guardar</button>
    </div>
  </div>

  <script>
    const malla = [
      {
        nombre: "1er Semestre",
        materias: [
          { nombre: "Álgebra Superior", creditos: 6, tipo: "matematicas" },
          { nombre: "Física I", creditos: 6, tipo: "fisicas", requiere: ["Álgebra Superior"] },
          { nombre: "Programación", creditos: 5, tipo: "programacion" },
          { nombre: "Química General", creditos: 5, tipo: "biologicas" },
          { nombre: "Redacción", creditos: 3, tipo: "otros" }
        ]
      },
      {
        nombre: "2do Semestre",
        materias: [
          { nombre: "Cálculo Diferencial", creditos: 6, tipo: "matematicas", requiere: ["Álgebra Superior"] },
          { nombre: "Física II", creditos: 6, tipo: "fisicas", requiere: ["Física I"] },
          { nombre: "Electrónica Digital", creditos: 5, tipo: "electronica", requiere: ["Programación"] },
          { nombre: "Inglés I", creditos: 3, tipo: "idiomas" }
        ]
      }
    ];

    const contenedor = document.getElementById("contenedor");
    let calificaciones = {};
    let materiaSeleccionada = null;

    malla.forEach((semestre, idx) => {
      const card = document.createElement("div");
      card.className = "semestre-card";
      const titulo = document.createElement("div");
      titulo.className = "semestre-title";
      titulo.textContent = semestre.nombre;
      card.appendChild(titulo);

      semestre.materias.forEach(m => {
        const div = document.createElement("div");
        div.className = `subject ${m.tipo}`;

        const info = document.createElement("div");
        info.className = "info";
        info.textContent = m.nombre;

        const badge = document.createElement("div");
        badge.className = "credits";
        badge.textContent = m.creditos;

        const temario = document.createElement("div");
        temario.className = "temario";
        temario.textContent = "📄";
        temario.title = "Ver temario";
        temario.onclick = e => {
          e.stopPropagation();
          mostrarModal(m.nombre, `<p>Temario de ${m.nombre}</p>`);
        };

        const cal = document.createElement("div");
        cal.className = "calificacion-icon";
        cal.textContent = "🎓";
        cal.title = "Agregar calificación";
        cal.onclick = e => {
          e.stopPropagation();
          materiaSeleccionada = m.nombre;
          document.getElementById("input-calificacion").value = calificaciones[m.nombre] || "";
          mostrarModal(m.nombre, "Ingresa la calificación:");
        };

        div.onclick = () => {
          if (!div.classList.contains("locked")) {
            aprobarMateria(m.nombre);
            div.querySelector(".info").classList.add("aprobada");
            actualizar();
          }
        };

        div.appendChild(badge);
        div.appendChild(info);
        div.appendChild(temario);
        div.appendChild(cal);
        card.appendChild(div);
      });

      const fila = document.createElement("div");
      fila.className = "fila";
      fila.appendChild(card);
      contenedor.appendChild(fila);
    });

    function mostrarModal(titulo, cuerpo) {
      document.getElementById("modal-titulo").textContent = titulo;
      document.getElementById("modal-cuerpo").innerHTML = cuerpo;
      document.getElementById("modal").style.display = "flex";
    }

    document.getElementById("modal").onclick = (e) => {
      if (e.target.id === "modal") document.getElementById("modal").style.display = "none";
    }

    function guardarCalificacion() {
      const val = document.getElementById("input-calificacion").value;
      if (!isNaN(val) && val !== "") {
        calificaciones[materiaSeleccionada] = Number(val);
        document.getElementById("modal").style.display = "none";
        actualizar();
      }
    }

    const aprobadas = new Set();

    function aprobarMateria(nombre) {
      aprobadas.add(nombre);
    }

    function actualizar() {
      const subjects = document.querySelectorAll(".subject");
      subjects.forEach(s => {
        const nombre = s.querySelector(".info").textContent;
        const data = buscarMateria(nombre);
        const requisitos = data?.requiere || [];
        const desbloqueada = requisitos.every(r => aprobadas.has(r));
        if (!aprobadas.has(nombre)) {
          s.classList.toggle("locked", !desbloqueada);
        }
        const info = s.querySelector(".info");
        if (aprobadas.has(nombre)) info.classList.add("aprobada");
      });

      let sum = 0, total = 0;
      for (let mat in calificaciones) {
        const cal = calificaciones[mat];
        const c = buscarMateria(mat)?.creditos || 0;
        sum += cal * c;
        total += c;
      }
      document.getElementById("promedio").textContent = total > 0 ? `Promedio: ${(sum/total).toFixed(2)}` : "Promedio: -";
      document.getElementById("contador").textContent = `Aprobadas: ${aprobadas.size}`;
    }

    function buscarMateria(nombre) {
      for (const semestre of malla) {
        for (const m of semestre.materias) {
          if (m.nombre === nombre) return m;
        }
      }
      return null;
    }

    actualizar();
  </script>
</body>
</html>
