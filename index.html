<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Malla Curricular Biónica (UPIITA-IPN)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center;
      margin-bottom: 10px;
    }

    #promedio {
      position: absolute;
      top: 20px;
      right: 20px;
      font-weight: bold;
    }

    .semestre {
      margin-bottom: 30px;
    }

    .semestre h2 {
      margin-bottom: 10px;
    }

    .materias {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .materia {
      background: white;
      border: 2px solid #ddd;
      border-radius: 12px;
      padding: 10px 16px;
      width: 220px;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.05);
      position: relative;
    }

    .materia.tachada {
      opacity: 0.5;
      text-decoration: line-through;
    }

    .creditos {
      position: absolute;
      left: 10px;
      top: 10px;
      font-size: 0.8em;
      color: #555;
    }

    .calificacion {
      position: absolute;
      right: 10px;
      top: 10px;
      width: 40px;
      border: 1px solid #aaa;
      border-radius: 4px;
      text-align: center;
    }

    input:disabled {
      background-color: #eee;
    }
  </style>
</head>
<body>

<h1>Malla Curricular Biónica (UPIITA-IPN)</h1>
<div id="promedio">Promedio: --</div>
<div id="malla"></div>

<script>
const materias = [
  { nombre: "Cálculo diferencial e integral", semestre: 1, creditos: 10, desbloquea: [2], calificacion: null },
  { nombre: "Álgebra lineal", semestre: 1, creditos: 8, desbloquea: [3], calificacion: null },
  { nombre: "Biología celular", semestre: 1, creditos: 7, desbloquea: [], calificacion: null },
  { nombre: "Química orgánica", semestre: 1, creditos: 7, desbloquea: [], calificacion: null },
  { nombre: "Física I", semestre: 2, creditos: 9, desbloquea: [], calificacion: null },
  { nombre: "Ecuaciones diferenciales", semestre: 3, creditos: 9, desbloquea: [], calificacion: null }
];

function crearTarjetaMateria(materia) {
  const tarjeta = document.createElement("div");
  tarjeta.className = "materia";

  const nombre = document.createElement("h3");
  nombre.textContent = materia.nombre;
  tarjeta.appendChild(nombre);

  const creditos = document.createElement("div");
  creditos.className = "creditos";
  creditos.textContent = `${materia.creditos} cr`;
  tarjeta.appendChild(creditos);

  const input = document.createElement("input");
  input.type = "number";
  input.className = "calificacion";
  input.min = 0;
  input.max = 10;
  input.placeholder = "--";
  input.value = materia.calificacion ?? "";
  input.disabled = !materia.desbloqueadas;

  input.addEventListener("change", () => {
    const valor = parseFloat(input.value);
    if (!isNaN(valor)) {
      materia.calificacion = valor;
      desbloquearMaterias(materia);
      renderMalla();
    }
  });

  tarjeta.appendChild(input);

  if (materia.calificacion !== null) {
    tarjeta.classList.add("tachada");
  }

  return tarjeta;
}

function desbloquearMaterias(materia) {
  if (materia.desbloquea) {
    materia.desbloquea.forEach(index => {
      materias[index].desbloqueadas = true;
    });
  }
}

function renderMalla() {
  const contenedor = document.getElementById("malla");
  contenedor.innerHTML = "";

  const promedioEl = document.getElementById("promedio");
  let total = 0, count = 0;

  for (let semestre = 1; semestre <= 10; semestre++) {
    const grupo = materias.filter(m => m.semestre === semestre);
    if (grupo.length === 0) continue;

    const contenedorSemestre = document.createElement("div");
    contenedorSemestre.className = "semestre";

    const titulo = document.createElement("h2");
    titulo.textContent = `Semestre ${semestre}`;
    contenedorSemestre.appendChild(titulo);

    const fila = document.createElement("div");
    fila.className = "materias";

    grupo.forEach(m => {
      if (m.calificacion !== null) {
        total += m.calificacion;
        count++;
      }
      fila.appendChild(crearTarjetaMateria(m));
    });

    contenedorSemestre.appendChild(fila);
    contenedor.appendChild(contenedorSemestre);
  }

  promedioEl.textContent = count ? `Promedio: ${(total / count).toFixed(2)}` : "Promedio: --";
}

// Inicializar desbloqueo
materias.forEach(m => {
  m.desbloqueadas = m.semestre === 1;
});

renderMalla();
</script>
</body>
</html>
